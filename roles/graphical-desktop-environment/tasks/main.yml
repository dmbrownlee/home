---
- name: Ensure OS specific vars have been loaded
  ansible.builtin.include_vars: "{{ ansible_distribution | lower }}.yml"
- name: Ensure the repo for Google Chrome is enabled
  ansible.builtin.yum_repository:
    name: google-chrome
    description: Where does this end up?
    state: present
    baseurl: https://dl.google.com/linux/chrome/rpm/stable/x86_64
    enabled: yes
    gpgcheck: yes
    gpgkey: https://dl.google.com/linux/linux_signing_key.pub
    owner: root
    group: root
    mode: '0644'
  when:
    - chrome_should_be_installed is defined
    - chrome_should_be_installed
- name: Ensure dnf packages are installed
  ansible.builtin.dnf:
    name: "{{ item }}"
    state: present
  loop: "{{ dnf_packages }}"
  when:
    - ansible_pkg_mgr == 'dnf'
    - dnf_packages is defined
    - (dnf_packages | length > 0)
- name: Ensure default systemd target is graphical.target
  ansible.builtin.file:
    src: /usr/lib/systemd/system/graphical.target
    dest: /etc/systemd/system/default.target
    state: link
- name: Ensure autofs is enabled
  ansible.builtin.service:
    name: autofs
    state: started
    enabled: yes
- name: Ensure the ansible user is hidden from the display manager login screen
  ansible.builtin.copy:
    src: ansible
    dest: /var/lib/AccountsService/users
    mode: '0600'
  notify: restart_display_manager
- name: Ensure Google Chrome is installed if requested
  ansible.builtin.package:
    name: google-chrome-stable
    state: present
  when:
    - chrome_should_be_installed is defined
    - chrome_should_be_installed
