---
- name: Assert this host can use this role
  ansible.builtin.assert:
    that: ansible_distribution in supported_distributions
    fail_msg: "This role is not supported on your host operating system."
# - name: Include OS specific variables
#   include_vars: "{{ ansible_distribution | lower }}.yml"
- name: Ensure baseline packages are installed
  ansible.builtin.package:
    name:
      - vim-enhanced
      - vim-airline
      - vim-ansible
      - vim-commentary
      - vim-fugitive
      - vim-nerdtree
      - vim-nerdtree-git-plugin
      - vim-syntastic
      - vim-syntastic-ansible
      - vim-syntastic-python
      - vim-syntastic-sh
      - tmux
      - git
    state: present
- name: Ensure confmgt user exists
  ansible.builtin.user:
    name: confmgt
    state: present
    system: yes
- name: Ensure confmgt user can use sudo
  ansible.builtin.copy:
    dest: /etc/sudoers.d/confmgt
    content: 'confmgt ALL=(ALL) NOPASSWD: ALL'
    owner: root
    group: root
    mode: 0440
- name: Ensure confmgt user has cronjob to run ansible-pull regularly
  ansible.builtin.cron:
    name: ansible-pull
    state: present
    user: confmgt
    job: /usr/bin/ansible-pull -o -U https://github.com/dmbrownlee/home.git
    minute: '*/10'
# - name: role packages
#   include_tasks: "packages-{{ ansible_distribution | lower }}.yml"
# - name: shell configuration
#   include_tasks: "{{ ansible_user_shell | basename }}-config.yml"
# - name: tmux configuration
#   include_tasks: tmux.yml
# - name: git configuration
#   include_tasks: git.yml
# - name: vim configuration
#   include_tasks: vim.yml
